<?xml version='1.0' encoding='utf-8'?>
<spec xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:style="http://siyavula.com/cnxml/style/0.1">
  <entry>
    <xpath>/document</xpath>
    <children>
      <optional>metadata</optional><!-- occurs 0 or 1 times -->
      <element>content</element><!-- occurs exactly once -->
    </children>
    <notext/>
    <documentation>
The document element is the root.
It may have a metadata element and must have a content element.
    </documentation>
  </entry>

  <entry>
    <xpath>/document/metadata</xpath>
    <children>
      <subset-of><!-- subsetsof: at most one of each in the set; unordered -->
	<element>cnxml-version</element>
	<element>pspicture-generator-version</element>
      </subset-of>
    </children>
    <notext/>
    <documentation>
The metadata section contains information about the XML document itself.
Only version numbers at this time.
You must not edit this section manually, unless you really know what you're doing.
    </documentation>
  </entry>

  <entry>
    <xpath>/document/metadata/cnxml-version</xpath>
    <text>
      <pre-processing-callback>strip</pre-processing-callback>
    </text>
    <validation-callback>is_version_number</validation-callback>
  </entry>

  <entry>
    <xpath>/document/metadata/pspicture-generator-version</xpath>
    <text>
      <pre-processing-callback>strip</pre-processing-callback>
    </text>
    <validation-callback>is_version_number</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content</xpath>
    <children>
      <one-of>
	<any-number>
	  <element>section</element>
	</any-number>
	<reference>block-element</reference>
      </one-of>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//activity/section</xpath>
    <children>
      <element>title</element>
      <reference>block-element-no-subsections</reference>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//section</xpath>
    <attributes>
      <entry>
	<name>type</name>
	<type>enum("chapter","section","subsection","subsubsection")</type>
      </entry>
    </attributes>
    <children>
      <element>title</element>
      <optional>shortcode</optional><!--TODO: this should be required-->
      <reference>block-element</reference>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//section/title</xpath>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//section/shortcode</xpath>
    <validation-callback>is_section_shortcode</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//para</xpath>
    <children>
      <reference>inline-container-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//list</xpath>
    <attributes>
      <entry>
	<name>list-type</name>
	<type>enum("bulleted","enumerated")</type>
	<default>bulleted</default>
      </entry>
      <entry>
	<name>start-value</name>
	<type>integer(1,)</type>
	<default>1</default>
      </entry>
    </attributes>
    <children>
      <any-number from="1">
	<element>item</element>
      </any-number>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//list/item</xpath>
    <children>
      <one-of>
	<reference>block-element-no-subsections</reference>
	<reference>inline-element</reference>
      </one-of>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//exercises</xpath>
    <children>
      <optional>title</optional>
      <any-number>
	<element>entry</element>
      </any-number>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//exercises/title</xpath>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//exercises/entry</xpath>
    <children>
      <element>shortcode</element>
      <element>problem</element>
      <element>solution</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//exercises/entry/shortcode</xpath>
    <validation-callback>is_exercise_shortcode</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//exercises/entry/problem</xpath>
    <children>
      <reference>block-element-no-subsections</reference>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//exercises/entry/solution</xpath>
    <attributes>
      <entry>
	<name>url</name>
	<type>url</type>
	<default/>
      </entry>
    </attributes>
    <children>
      <reference>block-element-no-subsections</reference>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//definition</xpath>
    <children>
      <element>term</element>
      <element>meaning</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//definition/term</xpath>
  </entry>

  <entry>
    <xpath>/document/content//definition/meaning</xpath>
    <children>
      <one-of>
	<reference>block-element-no-subsections</reference>
	<reference>inline-element</reference>
      </one-of>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//activity</xpath>
    <attributes>
      <entry>
	<name>type</name>
	<type>enum("groupdiscussion","casestudy")</type>
      </entry>
    </attributes>
    <children>
      <element>title</element>
      <reference>block-element</reference>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//note</xpath>
    <attributes>
      <entry>
	<name>type</name>
	<type>enum("tip")</type>
      </entry>
    </attributes>
    <children>
      <reference>block-element-no-subsections</reference>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//activity/title</xpath>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//worked_example</xpath>
    <children>
      <element>title</element>
      <element>question</element>
      <element>answer</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//worked_example/title</xpath>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//worked_example/question</xpath>
    <children>
      <one-of>
	<reference>block-element-no-subsections</reference>
	<reference>inline-element</reference>
      </one-of>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//worked_example/answer</xpath>
    <children>
      <any-number from="1">
	<element>workstep</element>
      </any-number>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//worked_example/answer/workstep</xpath>
    <children>
      <element>title</element>
      <reference>block-element-no-subsections</reference>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//worked_example/answer/workstep/title</xpath>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//presentation</xpath>
    <children>
      <element>shortcode</element>
      <element>url</element>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//presentation/shortcode</xpath>
    <validation-callback>is_rich_media_shortcode</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//presentation/url</xpath>
  </entry>

  <entry>
    <xpath>/document/content//simulation</xpath>
    <children>
      <element>title</element>
      <element>shortcode</element>
      <element>url</element>
      <element>embed</element>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//simulation/title</xpath>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//simulation/shortcode</xpath>
    <validation-callback>is_rich_media_shortcode</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//simulation/url</xpath>
  </entry>

  <entry>
    <xpath>/document/content//simulation/embed</xpath>
    <validation-callback>is_valid_html</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//video</xpath>
    <children>
      <element>title</element>
      <element>shortcode</element>
      <element>url</element>
      <optional>width</optional>
      <optional>height</optional>
      <optional>url</optional>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//video/title</xpath>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//video/shortcode</xpath>
    <validation-callback>is_rich_media_shortcode</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//video/url</xpath>
  </entry>

  <entry>
    <xpath>/document/content//video/width</xpath>
    <validation-callback>is_int</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//video/height</xpath>
    <validation-callback>is_int</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//figure</xpath>
    <children>
      <element>type</element>
      <one-of>
	<element>table</element>
	<element>pspicture</element>
	<element>tikzpicture</element>
	<element>image</element>
      </one-of>
      <optional>caption</optional>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//pspicture</xpath>
    <attributes>
      <entry>
	<name>style:width</name>
	<type>number</type>
	<default/>
      </entry>
    </attributes>
    <children>
      <any-number>
	<element>usepackage</element>
      </any-number>
      <element>code</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//pspicture/usepackage</xpath>
  </entry>

  <entry>
    <xpath>/document/content//pspicture/code</xpath>
  </entry>

  <entry>
    <xpath>/document/content//tikzpicture</xpath>
    <attributes>
      <entry>
	<name>style:width</name>
	<type>number</type>
	<default/>
      </entry>
    </attributes>
    <children>
      <any-number>
	<element>usepackage</element>
      </any-number>
      <element>code</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//tikzpicture/usepackage</xpath>
  </entry>

  <entry>
    <xpath>/document/content//tikzpicture/code</xpath>
  </entry>

  <entry>
    <xpath>/document/content//image</xpath>
    <attributes>
      <entry>
	<name>style:width</name>
	<type>number</type>
	<default/>
      </entry>
    </attributes>
    <children>
      <element>src</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//image/src</xpath>
  </entry>

  <entry>
    <xpath>/document/content//figure/type</xpath>
    <validation-callback>is_figue_type</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//figure/caption</xpath>
    <children>
      <one-of>
	<reference>block-element-no-subsections</reference>
	<reference>inline-element</reference>
      </one-of>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//table</xpath>
    <children>
      <element>tgroup</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//table/tgroup</xpath>
    <attributes>
      <entry>
	<name>cols</name>
	<type>integer(1,)</type>
	<default/>
      </entry>
    </attributes>
    <children>
      <any-number from="1">
	<element>colspec</element>
      </any-number>
      <element>tbody</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//table/tgroup/colspec</xpath>
    <attributes>
      <entry>
	<name>colname</name>
	<type>string</type>
	<default/>
      </entry>
      <entry>
	<name>colnum</name>
	<type>integer(1,)</type>
      </entry>
    </attributes>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//table/tgroup/tbody</xpath>
    <children>
      <any-number>
	<element>row</element>
      </any-number>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//table/tgroup/tbody/row</xpath>
    <children>
      <any-number>
	<element>entry</element>
      </any-number>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//table/tgroup/tbody/row/entry</xpath>
    <attributes>
      <entry>
	<name>namest</name>
	<type>string</type>
	<default/>
      </entry>
      <entry>
	<name>nameend</name>
	<type>string</type>
	<default/>
      </entry>
      <entry>
	<name>align</name>
	<type>enum("center")</type>
	<default/>
      </entry>
    </attributes>
    <children>
      <one-of>
	<reference>block-element-no-subsections</reference>
	<reference>inline-element</reference>
      </one-of>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//equation</xpath>
    <children>
      <element>m:math</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//latex</xpath>
    <attributes>
      <entry>
	<name>display</name>
	<type>enum("inline","block")</type>
	<default>inline</default>
      </entry>
    </attributes>
    <children>
      <any-number>
	<one-of>
	  <element>number</element>
	  <element>unit</element>
	  <element>unit_number</element>
	</one-of>
      </any-number>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//m:math</xpath>
    <children>
      <reference>math-stuff</reference>
    </children>
    <notext/>
  </entry>

  <entry><xpath>/document/content//m:mrow</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mfrac</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mfenced</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mi</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mo</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mn</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mtable</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mtr</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mtd</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mtext</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:msub</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:msup</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mspace</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mphantom</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mstyle</xpath><children><reference>math-stuff</reference></children><notext/></entry>
  <entry><xpath>/document/content//m:mover</xpath><children><reference>math-stuff</reference></children><notext/></entry>

  <entry id="math-stuff">
    <children>
      <any-number>
	<one-of>
	  <element>m:mrow</element>
	  <element>m:mfrac</element>
	  <element>m:mfenced</element>
	  <element>m:mi</element>
	  <element>m:mo</element>
	  <element>m:mn</element>
	  <element>m:mtable</element>
	  <element>m:mtr</element>
	  <element>m:mtd</element>
	  <element>m:mtext</element>
	  <element>m:msub</element>
	  <element>m:msup</element>
	  <element>m:mspace</element>
	  <element>m:mphantom</element>
	  <element>m:mstyle</element>
	  <element>m:mover</element>
	</one-of>
      </any-number>
    </children>
  </entry>

  <entry id="block-element">
    <children>
      <any-number>
	<one-of>
	  <element>section</element>
	  <reference>block-element-no-subsections-entry</reference>
	</one-of>
      </any-number>
    </children>
  </entry>

  <entry id="block-element-no-subsections">
    <children>
      <any-number>
	<reference>block-element-no-subsections-entry</reference>
      </any-number>
    </children>
  </entry>

  <entry id="block-element-no-subsections-entry">
    <children>
      <one-of>
	<element>para</element>
	<element>video</element>
	<element>presentation</element>
	<element>simulation</element>
	<element>list</element>
	<element>equation</element>
	<element>latex</element>
	<element>worked_example</element>
	<element>figure</element>
	<element>image</element>
	<element>pspicture</element>
	<element>tikzpicture</element>
	<element>table</element>
	<element>definition</element>
	<element>activity</element>
	<element>exercises</element>
	<element>note</element>
      </one-of>
    </children>
  </entry>

  <entry id="inline-container-element">
    <children>
      <any-number>
	<one-of>
	  <element>emphasis</element>
	  <element>sub</element>
	  <element>sup</element>
	  <element>list</element>
	  <element>media</element>
	  <element>link</element>
	  <element>unit_number</element>
	  <element>number</element>
	  <element>unit</element>
	  <element>m:math</element>
	  <element>latex</element>
	  <element>chem_compound</element>
	  <element>spec_note</element>
	</one-of>
      </any-number>
    </children>
  </entry>

  <entry id="inline-element">
    <children>
      <any-number>
	<one-of>
	  <element>emphasis</element>
	  <element>sub</element>
	  <element>sup</element>
	  <element>link</element>
	  <element>unit_number</element>
	  <element>number</element>
	  <element>unit</element>
	  <element>m:math</element>
	  <element>latex</element>
	  <element>chem_compound</element>
	  <element>spec_note</element>
	</one-of>
      </any-number>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//unit_number</xpath>
    <children>
      <element>number</element>
      <element>unit</element>
    </children>
    <notext/>
  </entry>

  <entry>
    <xpath>/document/content//chem_compound</xpath>
  </entry>

  <entry>
    <xpath>/document/content//spec_note</xpath>
  </entry>

  <entry>
    <xpath>/document/content//number</xpath>
    <children>
      <subset-of>
	<element>coeff</element>
	<element>base</element>
	<element>exp</element>
      </subset-of>
    </children>
    <validation-callback>is_number</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//number/coeff</xpath>
  </entry>

  <entry>
    <xpath>/document/content//number/base</xpath>
  </entry>

  <entry>
    <xpath>/document/content//number/exp</xpath>
  </entry>

  <entry>
    <xpath>/document/content//unit</xpath>
    <children>
      <any-number>
	<one-of>
	  <element>sub</element>
	  <element>sup</element>
	</one-of>
      </any-number>
    </children>
    <validation-callback>is_unit</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//emphasis</xpath>
    <attributes>
      <entry>
	<name>effect</name>
	<type>enum("bold","italics","underline","smallcaps","normal")</type>
	<default>bold</default>
      </entry>
    </attributes>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//link</xpath>
    <attributes>
      <entry>
	<name>url</name>
	<type>url</type>
	<default/>
      </entry>
      <entry>
	<name>target-id</name>
	<type>string</type>
	<default/>
      </entry>
    </attributes>
    <children>
      <reference>inline-element</reference>
    </children>
    <validation-callback>check_link_element</validation-callback>
  </entry>

  <entry>
    <xpath>/document/content//sub</xpath>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

  <entry>
    <xpath>/document/content//sup</xpath>
    <children>
      <reference>inline-element</reference>
    </children>
  </entry>

<!--
/document/content//section/title
contains :inline-element:
text

/document/content//section/shortcode
text.strip
validation-callback: is_shortcode

:block-element:/para
-->

</spec>
